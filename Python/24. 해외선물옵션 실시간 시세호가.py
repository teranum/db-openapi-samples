import asyncio
import dbopenapi
from app_keys import appkey, appsecretkey, saved_access_token # app_keys.py 파일에 appkey, appsecretkey 변수를 정의하고 사용하세요

'''
해외선물옵션 로그인시 반드시 wss_domain 옵션을 dbopenapi.WSS_URL_GLOBAL로 설정.
'''
async def main():
    api=dbopenapi.OpenApi()
    api.on_message = on_message
    api.on_realtime = on_realtime
    # if not await api.login(appkey, appsecretkey, wss_domain=dbopenapi.WSS_URL_GLOBAL): return print(f'연결실패: {api.last_message}')
    if not await api.login('', '', access_token=saved_access_token, wss_domain=dbopenapi.WSS_URL_GLOBAL): return print(f'연결실패: {api.last_message}')

    종목코드 = input('종목코드를 입력하세요: ')
    
    # 해외선물옵션 시세/호가 실시간 요청
    if not await api.add_realtime('', 종목코드): print(f'실시간 등록 실패: {api.last_message}')
    
    # 10분후 실시간 시세 중지
    print('10분동안 실시간 작동중...');
    await asyncio.sleep(600)
    if not await api.remove_realtime('', 종목코드): print(f'실시간 중지 실패: {api.last_message}')
    await asyncio.sleep(1)
    
    ... # 다른 작업 수행
    await api.close()
    

def on_message(api, msg:str): print(f'on_message: {msg}')

def on_realtime(api, trcode, key, realtimedata):
    if trcode == 'K': # 해외선물옵션 시세
        print(f'시세: {trcode}, {key}, {realtimedata}')
    elif trcode == 'L': # 해외선물옵션 호가
        print(f'호가: {trcode}, {key}, {realtimedata}')
        
asyncio.run(main())

# Output:
'''
종목코드를 입력하세요: HSIK24
10분동안 실시간 작동중...
on_message: (1): 정상처리되었습니다.
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003459', 'Out1': [{'AskP': '19743', 'AskQ': '1', 'AskN': '1'}, {'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '7', 'AskN': '7'}, {'AskP': '19746', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19747', 'AskQ': '7', 'AskN': '7'}], 'Out2': [{'BidP': '19741', 'BidQ': '1', 'BidN': '1'}, {'BidP': '19740', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19737', 'BidQ': '8', 'BidN': '7'}], 'Out3': {'AskQ': '23', 'BidQ': '25', 'AskN': '23', 'BidN': '24'}}
시세: K, None, {'AvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'CCol': '1', 'Last': '19742', 'Sign': '+', 'Diff': '000000200', 'Rate': '102', 'VCol': '2', 'LVol': '3', 'TVol': '16051', 'Open': '19543', 'High': '19772', 'LowP': '19505', 'TdTm': '003500', 'TDay': '20240518', 'BDay': '20240520', 'Seqn': '', 'BidN': '', 'AskN': '', 'Amnt': '', 'Oint': '', 'Tgub': ''}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003500', 'Out1': [{'AskP': '19744', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19745', 'AskQ': '7', 'AskN': '6'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '7', 'AskN': '7'}, {'AskP': '19748', 'AskQ': '5', 'AskN': '5'}], 'Out2': [{'BidP': '19741', 'BidQ': '6', 'BidN': '6'}, {'BidP': '19740', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19737', 'BidQ': '7', 'BidN': '6'}], 'Out3': {'AskQ': '25', 'BidQ': '30', 'AskN': '24', 'BidN': '29'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003500', 'Out1': [{'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '7', 'AskN': '6'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19748', 'AskQ': '4', 'AskN': '4'}], 'Out2': [{'BidP': '19741', 'BidQ': '6', 'BidN': '6'}, {'BidP': '19740', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19737', 'BidQ': '7', 'BidN': '6'}], 'Out3': {'AskQ': '26', 'BidQ': '30', 'AskN': '25', 'BidN': '29'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003500', 'Out1': [{'AskP': '19744', 'AskQ': '1', 'AskN': '1'}, {'AskP': '19745', 'AskQ': '5', 'AskN': '4'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19748', 'AskQ': '4', 'AskN': '4'}], 'Out2': [{'BidP': '19742', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19741', 'BidQ': '7', 'BidN': '7'}, {'BidP': '19740', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}], 'Out3': {'AskQ': '21', 'BidQ': '26', 'AskN': '20', 'BidN': '26'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003501', 'Out1': [{'AskP': '19745', 'AskQ': '5', 'AskN': '4'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19748', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19749', 'AskQ': '6', 'AskN': '6'}], 'Out2': [{'BidP': '19742', 'BidQ': '3', 'BidN': '3'}, {'BidP': '19741', 'BidQ': '7', 'BidN': '7'}, {'BidP': '19740', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}], 'Out3': {'AskQ': '26', 'BidQ': '26', 'AskN': '25', 'BidN': '26'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003501', 'Out1': [{'AskP': '19745', 'AskQ': '6', 'AskN': '5'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19748', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19749', 'AskQ': '6', 'AskN': '6'}], 'Out2': [{'BidP': '19742', 'BidQ': '3', 'BidN': '3'}, {'BidP': '19741', 'BidQ': '7', 'BidN': '7'}, {'BidP': '19740', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}], 'Out3': {'AskQ': '27', 'BidQ': '26', 'AskN': '26', 'BidN': '26'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003501', 'Out1': [{'AskP': '19743', 'AskQ': '1', 'AskN': '1'}, {'AskP': '19744', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19745', 'AskQ': '7', 'AskN': '6'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}], 'Out2': [{'BidP': '19742', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19741', 'BidQ': '6', 'BidN': '6'}, {'BidP': '19740', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}], 'Out3': {'AskQ': '22', 'BidQ': '24', 'AskN': '21', 'BidN': '24'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003501', 'Out1': [{'AskP': '19744', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19745', 'AskQ': '7', 'AskN': '6'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19748', 'AskQ': '4', 'AskN': '4'}], 'Out2': [{'BidP': '19742', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19741', 'BidQ': '6', 'BidN': '6'}, {'BidP': '19740', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}], 'Out3': {'AskQ': '25', 'BidQ': '24', 'AskN': '24', 'BidN': '24'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003502', 'Out1': [{'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19748', 'AskQ': '4', 'AskN': '4'}], 'Out2': [{'BidP': '19742', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19741', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19740', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}], 'Out3': {'AskQ': '27', 'BidQ': '23', 'AskN': '26', 'BidN': '23'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003502', 'Out1': [{'AskP': '19744', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19745', 'AskQ': '7', 'AskN': '6'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19748', 'AskQ': '4', 'AskN': '4'}], 'Out2': [{'BidP': '19742', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19741', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19740', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}], 'Out3': {'AskQ': '25', 'BidQ': '23', 'AskN': '24', 'BidN': '23'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003503', 'Out1': [{'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19748', 'AskQ': '4', 'AskN': '4'}], 'Out2': [{'BidP': '19742', 'BidQ': '1', 'BidN': '1'}, {'BidP': '19741', 'BidQ': '3', 'BidN': '3'}, {'BidP': '19740', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}], 'Out3': {'AskQ': '27', 'BidQ': '21', 'AskN': '26', 'BidN': '21'}}
시세: K, None, {'AvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'CCol': '1', 'Last': '19742', 'Sign': '+', 'Diff': '000000200', 'Rate': '102', 'VCol': '2', 'LVol': '2', 'TVol': '16053', 'Open': '19543', 'High': '19772', 'LowP': '19505', 'TdTm': '003503', 'TDay': '20240518', 'BDay': '20240520', 'Seqn': '', 'BidN': '', 'AskN': '', 'Amnt': '', 'Oint': '', 'Tgub': ''}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003503', 'Out1': [{'AskP': '19743', 'AskQ': '2', 'AskN': '2'}, {'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}], 'Out2': [{'BidP': '19741', 'BidQ': '3', 'BidN': '3'}, {'BidP': '19740', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19739', 'BidQ': '7', 'BidN': '7'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19737', 'BidQ': '6', 'BidN': '5'}], 'Out3': {'AskQ': '25', 'BidQ': '24', 'AskN': '24', 'BidN': '23'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003503', 'Out1': [{'AskP': '19743', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}], 'Out2': [{'BidP': '19741', 'BidQ': '3', 'BidN': '3'}, {'BidP': '19740', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19737', 'BidQ': '7', 'BidN': '6'}], 'Out3': {'AskQ': '26', 'BidQ': '25', 'AskN': '25', 'BidN': '24'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003503', 'Out1': [{'AskP': '19743', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}, {'AskP': '19746', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19747', 'AskQ': '8', 'AskN': '8'}], 'Out2': [{'BidP': '19740', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19737', 'BidQ': '7', 'BidN': '6'}, {'BidP': '19736', 'BidQ': '11', 'BidN': '6'}], 'Out3': {'AskQ': '27', 'BidQ': '33', 'AskN': '26', 'BidN': '27'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003504', 'Out1': [{'AskP': '19741', 'AskQ': '1', 'AskN': '1'}, {'AskP': '19742', 'AskQ': '1', 'AskN': '1'}, {'AskP': '19743', 'AskQ': '7', 'AskN': '7'}, {'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}], 'Out2': [{'BidP': '19740', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19737', 'BidQ': '8', 'BidN': '7'}, {'BidP': '19736', 'BidQ': '11', 'BidN': '6'}], 'Out3': {'AskQ': '21', 'BidQ': '33', 'AskN': '20', 'BidN': '27'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003504', 'Out1': [{'AskP': '19741', 'AskQ': '1', 'AskN': '1'}, {'AskP': '19742', 'AskQ': '2', 'AskN': '2'}, {'AskP': '19743', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}], 'Out2': [{'BidP': '19740', 'BidQ': '2', 'BidN': '2'}, {'BidP': '19739', 'BidQ': '8', 'BidN': '8'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19737', 'BidQ': '8', 'BidN': '7'}, {'BidP': '19736', 'BidQ': '11', 'BidN': '6'}], 'Out3': {'AskQ': '23', 'BidQ': '33', 'AskN': '22', 'BidN': '27'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003504', 'Out1': [{'AskP': '19741', 'AskQ': '2', 'AskN': '2'}, {'AskP': '19742', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19743', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}], 'Out2': [{'BidP': '19739', 'BidQ': '5', 'BidN': '5'}, {'BidP': '19738', 'BidQ': '3', 'BidN': '3'}, {'BidP': '19737', 'BidQ': '8', 'BidN': '7'}, {'BidP': '19736', 'BidQ': '11', 'BidN': '6'}, {'BidP': '19735', 'BidQ': '8', 'BidN': '8'}], 'Out3': {'AskQ': '25', 'BidQ': '35', 'AskN': '24', 'BidN': '29'}}
호가: L, None, {'SvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'Htim': '003505', 'Out1': [{'AskP': '19741', 'AskQ': '2', 'AskN': '2'}, {'AskP': '19742', 'AskQ': '3', 'AskN': '3'}, {'AskP': '19743', 'AskQ': '8', 'AskN': '8'}, {'AskP': '19744', 'AskQ': '4', 'AskN': '4'}, {'AskP': '19745', 'AskQ': '8', 'AskN': '7'}], 'Out2': [{'BidP': '19739', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19738', 'BidQ': '4', 'BidN': '4'}, {'BidP': '19737', 'BidQ': '8', 'BidN': '7'}, {'BidP': '19736', 'BidQ': '11', 'BidN': '6'}, {'BidP': '19735', 'BidQ': '8', 'BidN': '8'}], 'Out3': {'AskQ': '25', 'BidQ': '35', 'AskN': '24', 'BidN': '29'}}
시세: K, None, {'AvTp': 'F', 'PrTp': 'HSI', 'Code': 'HSIK24', 'Pind': '1', 'CCol': '1', 'Last': '19741', 'Sign': '+', 'Diff': '000000199', 'Rate': '101', 'VCol': '1', 'LVol': '2', 'TVol': '16055', 'Open': '19543', 'High': '19772', 'LowP': '19505', 'TdTm': '003505', 'TDay': '20240518', 'BDay': '20240520', 'Seqn': '', 'BidN': '', 'AskN': '', 'Amnt': '', 'Oint': '', 'Tgub': ''}
'''